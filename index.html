<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wrong Answers Calculator</title>
  <style>
    :root {
      --panel-bg: rgba(12, 12, 12, 0.82);
      --display-bg: rgba(255, 255, 255, 0.1);
      --btn-bg: rgba(255, 255, 255, 0.16);
      --btn-bg-operator: rgba(255, 210, 80, 0.24);
      --btn-bg-clear: rgba(255, 90, 120, 0.3);
      --text: #f8f8f8;
      --shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      --radius: 16px;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      font-family: "Trebuchet MS", "Segoe UI", sans-serif;
      color: var(--text);
    }

    body {
      position: relative;
      background: linear-gradient(
        120deg,
        #ff3b3b,
        #ffa53b,
        #ffee3b,
        #60ff7b,
        #49d9ff,
        #5f7bff,
        #ce66ff,
        #ff56b6
      );
      background-size: 400% 400%;
      animation: rainbowShift 13s ease infinite;
    }

    @keyframes rainbowShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .calculator {
      position: absolute;
      width: min(90vw, 340px);
      padding: 16px;
      border-radius: var(--radius);
      background: var(--panel-bg);
      backdrop-filter: blur(6px);
      box-shadow: var(--shadow);
      transition: left 220ms ease, top 220ms ease;
    }

    .display {
      width: 100%;
      min-height: 64px;
      margin-bottom: 12px;
      padding: 14px;
      border-radius: 10px;
      background: var(--display-bg);
      text-align: right;
      font-size: 1.5rem;
      line-height: 1.4;
      word-break: break-all;
    }

    .keys {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }

    button {
      border: 0;
      border-radius: 10px;
      min-height: 52px;
      font-size: 1.1rem;
      color: var(--text);
      background: var(--btn-bg);
      cursor: pointer;
      transition: transform 80ms ease, filter 120ms ease;
    }

    button:hover {
      filter: brightness(1.12);
    }

    button:active {
      transform: scale(0.97);
    }

    button[data-type="op"] {
      background: var(--btn-bg-operator);
    }

    button[data-type="clear"] {
      background: var(--btn-bg-clear);
    }

    button.span-2 {
      grid-column: span 2;
    }
  </style>
</head>
<body>
  <div class="calculator" id="calculator">
    <div class="display" id="display">0</div>
    <div class="keys" id="keys">
      <button data-value="C" data-type="clear">C</button>
      <button data-value="/" data-type="op">/</button>
      <button data-value="*" data-type="op">*</button>
      <button data-value="-" data-type="op">-</button>

      <button data-value="7">7</button>
      <button data-value="8">8</button>
      <button data-value="9">9</button>
      <button data-value="+" data-type="op">+</button>

      <button data-value="4">4</button>
      <button data-value="5">5</button>
      <button data-value="6">6</button>
      <button data-value="=" data-type="op">=</button>

      <button data-value="1">1</button>
      <button data-value="2">2</button>
      <button data-value="3">3</button>
      <button data-value=".">.</button>

      <button class="span-2" data-value="0">0</button>
    </div>
  </div>

  <script>
    (function () {
      const calculator = document.getElementById("calculator");
      const display = document.getElementById("display");
      const keys = document.getElementById("keys");

      const playfulMessages = [
        "Nope",
        "Math says no",
        "Definitely 42",
        "Try again",
        "Not even close",
        "Banana"
      ];

      const state = {
        expression: "",
        justAnswered: false
      };

      function isDigit(value) {
        return /^[0-9]$/.test(value);
      }

      function moveCalculatorWithinViewport() {
        const rect = calculator.getBoundingClientRect();
        const maxLeft = Math.max(0, window.innerWidth - rect.width);
        const maxTop = Math.max(0, window.innerHeight - rect.height);
        const left = Math.random() * maxLeft;
        const top = Math.random() * maxTop;
        calculator.style.left = left + "px";
        calculator.style.top = top + "px";
      }

      function centerCalculator() {
        const rect = calculator.getBoundingClientRect();
        const left = Math.max(0, (window.innerWidth - rect.width) / 2);
        const top = Math.max(0, (window.innerHeight - rect.height) / 2);
        calculator.style.left = left + "px";
        calculator.style.top = top + "px";
      }

      function show(value) {
        display.textContent = value || "0";
      }

      function getWrongNumber(trueValue) {
        if (!Number.isFinite(trueValue)) {
          return null;
        }

        for (let i = 0; i < 8; i += 1) {
          const magnitude = Math.max(1, Math.abs(trueValue) * 0.35);
          const wobble = (Math.random() - 0.5) * magnitude * 2;
          const raw = trueValue + wobble;
          const rounded = Number.isInteger(trueValue)
            ? Math.round(raw)
            : Number(raw.toFixed(2));
          if (rounded !== trueValue && Number.isFinite(rounded)) {
            return rounded;
          }
        }

        return trueValue + 1;
      }

      function computeWrongOutput(expression) {
        if (!expression) {
          return playfulMessages[Math.floor(Math.random() * playfulMessages.length)];
        }

        try {
          const trueValue = Function('"use strict"; return (' + expression + ")")();
          const useMessage = Math.random() < 0.3;

          if (useMessage || !Number.isFinite(trueValue)) {
            return playfulMessages[Math.floor(Math.random() * playfulMessages.length)];
          }

          return String(getWrongNumber(trueValue));
        } catch (_err) {
          return playfulMessages[Math.floor(Math.random() * playfulMessages.length)];
        }
      }

      function handleButtonClick(value) {
        if (value === "C") {
          state.expression = "";
          state.justAnswered = false;
          show("0");
          return;
        }

        if (value === "=") {
          const wrong = computeWrongOutput(state.expression);
          show(wrong);
          state.justAnswered = true;
          return;
        }

        if (state.justAnswered && isDigit(value)) {
          state.expression = value;
          state.justAnswered = false;
          show(state.expression);
          return;
        }

        if (state.justAnswered && !isDigit(value)) {
          state.justAnswered = false;
        }

        state.expression += value;
        show(state.expression);
      }

      keys.addEventListener("click", function (event) {
        const button = event.target.closest("button[data-value]");
        if (!button) {
          return;
        }

        const value = button.dataset.value;
        if (isDigit(value)) {
          moveCalculatorWithinViewport();
        }
        handleButtonClick(value);
      });

      window.addEventListener("resize", function () {
        const rect = calculator.getBoundingClientRect();
        const maxLeft = Math.max(0, window.innerWidth - rect.width);
        const maxTop = Math.max(0, window.innerHeight - rect.height);
        calculator.style.left = Math.min(rect.left, maxLeft) + "px";
        calculator.style.top = Math.min(rect.top, maxTop) + "px";
      });

      centerCalculator();
    })();
  </script>
</body>
</html>
